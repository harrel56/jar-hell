import org.apache.tools.ant.taskdefs.condition.Os

configurations {
    output
}

tasks.register('clean') {
    delete files('dist')
}

tasks.register('build', Exec) {
    if (Os.isFamily(Os.FAMILY_WINDOWS)) {
        commandLine 'npm.cmd', 'ci'
    } else {
        commandLine 'npm', 'ci'
    }
    standardOutput System.out
    inputs.files(fileTree('.').matching {
        exclude 'dist', 'node_modules', 'package-lock.json'
    }.findAll())
    outputs.dir('dist')
}

artifacts {
    output(tasks.build.outputs.files.singleFile) {
        builtBy('build')
    }
}